{{> headdapoer}}
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <style>
                button.gm-fullscreen-control{
                    right: 20px !important;
                }
                .gm-bundled-control-on-bottom{
                    right: 64px !important;
                }
                .gmnoprint.gm-style-mtc {
                    display: none;
                    top: 5px !important;
                    left: 242px !important;
                    z-index: 99 !important;
                }
                .gmnoprint.gm-style-mtc {
                    left: 27.3vw !important;
                }

                .ui-menu.ui-widget.ui-widget-content.ui-autocomplete.ui-front{
                    z-index: 999;
                }

                .text-danger{
                    color: #dc3545 !important;
                }
            </style>

            <link rel="stylesheet" href="/public/assets/css/jquery-ui/jquery-ui.css">
            <script src="/public/assets/js/jquery-3.6.0.js"></script>
            <script src="/public/assets/js//1.13.1/jquery-ui.js"></script>
            <script src="/public/assets/js/sweetalert/sweetalert2@11.js"></script>

            <div class="content-page">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-12 ">
                            <div class="page-map2" style="">
                                <div id="my-modal2" class="modal" style="position: absolute !important; left:40%; top:40%; transform: translate(-53%, -43%);z-index:55;">
                                    <div class="modal-content" style="height: 100%;">
                                        <div class="modal-header">
                                            <h3><b></b></h3>
                                            <div id="sitemodaltitle" style="margin-top: 5px;margin-left:8px;">
                                            </div>
                                            <button type="button" class="close" id="closemodal" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body style-1" style="overflow-y: scroll;">
                                            <div id="chart_modal" style="height: 100%;">
                                            </div>
                                            <div id="detil_modal">
                                                <div id="poi_fail_list">
                                                    <table class="table">
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="core_category" style="
                                    position: absolute;
                                    top:15px;
                                    left: 3.5vw;
                                    z-index: 395;
                                    background-color: white;
                                    width:95px;
                                    padding:4px 0px 6px 8px;
                                    border-radius: 2px;
                                    box-shadow: rgb(0 0 0 / 30%) 0px 1px 4px -1px;">
                                        <div class="btn-group dropdown" style="width: 100%;">
                                            <div class="dropdown-toggle" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false" id="dropdowncategory" style="width: 100%;">
                                                Filter
                                            </div>
                                            <div class="dropdown-menu setdropdownmenu2" id="dropdowncategory2" aria-labelledby="dropdowncategory" style="">
                                                <a class="dropdown-item">All</a>
                                                <a class="dropdown-item">Core</a>
                                                <a class="dropdown-item">Non Core</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="searchsite" style="
                                        position: absolute;
                                        top:15px;
                                        left: 11.5vw;
                                        z-index: 395;">
                                        <form class="formsearch" action="javascript:void(0);">
                                            <input type="text" placeholder="Search.." name="search" id="inp_searchsite" autocomplete='new-password' />
                                            <button id="submit" type="submit"><i class="fa fa-search"></i></button>
                                        </form>
                                    </div>
                                    <div id="circle1" class="circle-1">
                                        <div style="margin-top:20px;">
                                            <div>Total Site</div>
                                            <div id="c_total_site" style="font-size: 24px;font-weight: bold;">0</div>
                                        </div>
                                    </div>
                                    <div id="circle2" class="circle-1" style="left: 28vw;">
                                        <div style="margin-top:20px;">
                                            <div>PLN</div>
                                            <div style="font-size: 24px;font-weight: bold;">12</div>
                                        </div>
                                    </div>
                                    <div id="circle3" class="circle-1" style="left: 38vw;">
                                        <div style="margin-top:20px;">
                                            <div>Non PLN</div>
                                            <div style="font-size: 24px;font-weight: bold;">11</div>
                                        </div>
                                    </div>
                                    <div id="circle4" class="circle-1" style="left: 48vw;">
                                        <div style="margin-top:20px;">
                                            <div>Alarm</div>
                                            <div style="font-size: 24px;font-weight: bold;">102</div>
                                        </div>
                                    </div>
                                    <div class="row" style="height: 100%;">
                                        <div id="map" style="height: 95%;"></div>
                                        <div class="col-xl-3" id="hasil" style="display:none; height: 100%;padding-right: 30px;">
                                            <div class="col-sm-12" id="creditcard">
                                                <div class="mini-stat-icon">
                                                    <div style="position: absolute;top:100px;right:25px;">
                                                        <img src="assets/icons/myicon/receiver.png" style="width: 170%;height:170%;opacity:0.3;-webkit-box-reflect: left;">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col" style="margin-top: 24px;">
                                                        <div class="col-sm-12" style="font-size: 16px;font-weight: bold;" id="head_siteid"></div>
                                                        <div class="col-sm-12" style="font-size: 12px;font-weight: lighter;" id="head_sitename"></div>
                                                        <div class="col-sm-12 mt-3" style="font-weight: lighter;font-size: 12px;" id="head_status_text"></div>
                                                        <div class="col-sm-12" style="font-weight: bold;font-size: 16px;" id="head_status_val"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12" style="background-color: white;height: 800px;margin-top:15px;border-radius: 20px;">
                                                <div class="tab">
                                                    <button class="tablinks active" onclick="openCity(event, 'overview')">Overview</button>
                                                    <button class="tablinks" onclick="openCity(event, 'rectifier')">Rectifier</button>
                                                    <button class="tablinks" onclick="openCity(event, 'environment')">Environment</button>
                                                </div>
                                                <div id="overview" class="row tabcontent style-1" style="font-size: 12px;padding-left:8px;padding-right:15px;display: block;height:56vh;overflow-y:auto;">
                                                    <div class="col-sm-12">
                                                        
                                                    </div>
                                                </div>
                                                <!--<div class="" style="padding-top: 12px;font-weight: bold;font-size: 16;padding-left:8px;">Detail Dapot Power</div>-->
                                                <div id="rectifier" class="row tabcontent style-1" style="font-size: 12px;padding-left:8px;padding-right:15px;height:56vh;overflow-y:auto;">
                                                    <div class="col-sm-12">           
                                                    </div>
                                                </div>
                                                <!-- Environment -->
                                                <div id="environment" class="row tabcontent" style="font-size: 12px;padding-left:8px;padding-right:15px;">
                                                    <div class="col-sm-12">                   
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Content Of All Results From Inputed Data-->
                        </div>
                        <!-- end row -->
                        <!-- end page content-->
                    </div> <!-- container-fluid -->
                </div> <!-- content -->
            </div>
            <!-- ============================================================== -->
            <!-- End Right content here -->
            <!-- ============================================================== -->
        </div>
        <!-- jQuery  -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/bootstrap.bundle.min.js"></script>
        <script src="assets/js/metisMenu.min.js"></script>
        <script src="assets/js/jquery.slimscroll.js"></script>
        <script src="assets/js/waves.min.js"></script>
        <script src="assets/js/jquery-ui.js"></script>
        <link rel="stylesheet" href="assets/css/jquery-ui/jquery-ui.css">
        <script src="plugins/jquery-sparkline/jquery.sparkline.min.js"></script>
        <!-- Peity JS -->
        <script src="plugins/peity/jquery.peity.min.js"></script>
        <!--<script src="plugins/morris/morris.min.js"></script>-->
        <script src="plugins/raphael/raphael-min.js"></script>
        <!--<script src="assets/pages/dashboard.js"></script>-->
        <!-- Required datatable js -->
        <script src="plugins/datatables/jquery.dataTables.min.js"></script>
        <script src="plugins/datatables/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="plugins/datatables/dataTables.buttons.min.js"></script>
        <script src="plugins/datatables/buttons.bootstrap4.min.js"></script>
        <script src="plugins/datatables/jszip.min.js"></script>
        <script src="plugins/datatables/pdfmake.min.js"></script>
        <script src="plugins/datatables/vfs_fonts.js"></script>
        <script src="plugins/datatables/buttons.html5.min.js"></script>
        <script src="plugins/datatables/buttons.print.min.js"></script>
        <script src="plugins/datatables/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="plugins/datatables/dataTables.responsive.min.js"></script>
        <script src="plugins/datatables/responsive.bootstrap4.min.js"></script>
        <!-- Datatable init js -->
        <script src="assets/pages/datatables.init.js"></script>
        <!-- App js -->
        <script src="assets/js/app.js"></script>
    </body>
</html>
{{> scripts}}
<script src="https://maps.googleapis.com/maps/api/js?sensor=true&&key=AIzaSyDMmDbfCdG2T-Vx2q1ANYogL3zoysgdxd0&&libraries=places,geometry"></script>
<script>
    var hasClickDetail = false;
    var hasHideDetail = false;
    var myMap = null;
    var dataQuota;
    var clickedCategory;

    hideDetail();

    $.ajax({
        type:"GET",
        url:"/dapot/json/outage_quota",
        data:{},
        beforeSend:function(){
            
        },
        success:function(data){
            dataQuota = data;
            //console.log(dataQuota)
            getMapDot('All');
        }
    });

    function getMapDot(core_type){
        var site_list = [];
        var content_list = [];
        $.ajax({
            type:"GET",
            url:"/dapot/json/smartsite_dapot",
            data:{core_type:core_type},
            beforeSend:function(){
                $("#map").html("<img style='width:70px;height:70px;margin:25% 10% 25% 50%; z-index:99;' src='/assets/images/loading.svg' />");
            },
            success:function(data){
                //INIZIALITE MAP Google Option
                myMap = new google.maps.Map(document.getElementById("map"), {
                    zoom: 12,
                    center: new google.maps.LatLng(-8.672784,115.228574),
                    mapTypeControl: true,
                    mapTypeControlOptions: {
                        style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                        position: google.maps.ControlPosition.TOP_CENTER,
                    },
                    navigationControl: true,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                });

                //INIZIALITE MAP Google Style
                var myStyle = [
                    {
                        featureType: "administrative",
                        elementType: "labels",
                        stylers: [
                        { visibility: "off" }
                        ]
                    },{
                        featureType: "poi",
                        elementType: "labels",
                        stylers: [
                        { visibility: "off" }
                        ]
                    },{
                        featureType: "water",
                        elementType: "labels",
                        stylers: [
                        { visibility: "off" }
                        ]
                    },{
                        featureType: "road",
                        elementType: "labels",
                        stylers: [
                        { visibility: "off" }
                        ]
                    }
                ];  

                //Initialize Value On Circles
                $("#c_total_site").html(data.length);

                var infowindow = new google.maps.InfoWindow();
                var marker, i;
                var icon = "";
                var marker_icon = "";
                var icon_size = "";

                for (i = 0; i < data.length; i++) {  
                    var C_SITE_ID = data[i].SITEID;
                    var content_rect = "";
                    var content_over = "";
                    var content_envi = "";

                    var tc_outage = "";
                    var tc_temp = "";
                    var tc_hum = "";
                    var tc_fuel = "";
                    var tc_vol = "", tc_vol2 = "", tc_vol3 = "";

                    var biaya;
                    var finalbiaya;

                    var foundOut = $.grep(dataQuota, function(v) {
                        return v.SITEID === C_SITE_ID;
                    });
                    var single_foundOut = foundOut[0];
                    var outage_quota, outage_percent, outage_second;

                    //Push all data to the needed list
                    site_list.push(data[i].SITEID);
                    site_list.push(data[i]["SITE NAME"]);

                    if(data[i].LONGITUDE != null){
                        switch(data[i].DEVICE_STATUS){
                            case "CONNECTED":
                                marker_icon = "green1.png";
                            break;

                            case "NOT CONNECTED":
                                marker_icon = "red1.png";
                            break;

                            case "NOT INSTALLED":
                                marker_icon = "black1.png";
                            break;
                        }

                        if(data[i]['Smart Site Impl'].includes("No")){
                            icon_size = 7;
                        } else
                        if(data[i]['Smart Site Impl'].includes("Yes")){
                            icon_size = 14;
                        }

                        icon = {
                            url: "assets/images/dots/"+marker_icon, // url
                            scaledSize: new google.maps.Size(icon_size, icon_size), // scaled size
                            origin: new google.maps.Point(0,0)/*, // origin
                            anchor: new google.maps.Point(15,30)*/
                        };

                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng(data[i].LATITUDE, data[i].LONGITUDE),
                            map: myMap,
                            icon:icon
                        });

                        google.maps.event.addListener(marker, 'mouseover', (function(marker, C_SITE_ID) {
                            return function() {
                            console.log(C_SITE_ID);
                            infowindow.setContent(C_SITE_ID);
                            infowindow.open(myMap, marker);
                            }
                        })(marker, C_SITE_ID));

                        for(x = 1; x <= 19 ; x++){
                            if(data[i]["Brand Rect "+x] != null && data[i]["Brand Rect "+x] != ""){
                                content_rect += '<div class="row mt-3">'
                                    +'<div class="col-sm-6">Brand Recti</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                    +'<div class="col-sm-5">'+data[i]["Brand Rect "+x]+'</div>'
                                +'</div>'
                                +'<div class="row mt-2">'
                                    +'<div class="col-sm-6">Type Recti</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                    +'<div class="col-sm-5">'+data[i]["Type Rect "+x]+'</div>'
                                +'</div>'
                                +'<div class="row mt-2">'
                                    +'<div class="col-sm-6">Merk Battery</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                    +'<div class="col-sm-5">'+data[i]["Merk Baterai "+x]+'</div>'
                                +'</div>'
                                +'<div class="row mt-2">'
                                    +'<div class="col-sm-6">Type Battery</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                    +'<div class="col-sm-5">'+data[i]["Type Rect "+x]+'</div>'
                                +'</div>'
                                +'<div class="row mt-2">'
                                    +'<div class="col-sm-6">Total Battery</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                    +'<div class="col-sm-5">'+data[i]["Jmlh Bank Baterai "+x]+'</div>'
                                +'</div>';
                            }
                        }
                        
                        function numberWithCommas(x) {
                            return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
                        }

                        biaya = data[i]["TL_CUR_MIN_1"];  
                        finalbiaya = numberWithCommas(biaya);

                        $.each(single_foundOut,function(key,value){
                            console.log(key+" "+value);
                            if(key == "TOAS") outage_second = value;
                            if(key == "PERCENT") outage_percent = value;
                            if(key == "OUTAGE_QUOTA") outage_quota = value;
                        });

                        if(outage_percent >= 80){
                            tc_outage = "text-danger";
                        }
                        
                        content_over = 
                            '<div class="row mt-3">'
                                +'<div class="col-sm-6">Class</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["CLASS 2022"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">NS</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["NS"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">DO</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["DO"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">TP</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["SITE OWNER"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Power Source</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["Power Source"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Cost Last Month</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">Rp.'+finalbiaya+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Average Cost</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">Rp.'+numberWithCommas(data[i]["TL_AVG"])+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Max Cost</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">Rp.'+numberWithCommas(data[i]["TL_MAX"])+'</div>'
                            +'</div>'
                            +'<div class="row mt-3">'
                                +'<div class="col-sm-6">Merk Genset</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["Merk Genset"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Type Genset</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["Type Genset"]+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Capacity Genset</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+data[i]["Cap Genset"]+'</div>'
                            +'</div>'
                             +'<div class="row mt-2 '+tc_outage+'">'
                                +'<div class="col-sm-6">Outage</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'+outage_second+' s ( '+outage_percent+' % From Quota '+outage_quota+' h ) </div>'
                            +'</div>'
                            +'<div class="switch-holder mt-2">'
                                +'<div class="col-sm-6 switch-label" style="padding: 0;">'
                                    +'<span>Genset</span>'
                                +'</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5 switch-toggle">'
                                    +'<input type="checkbox" id="gensetset">'
                                    +'<label for="gensetset"></label>'
                                +'</div>'
                            +'</div>' ;

                       
                        if(data[i].TEMP >= 37){
                            tc_temp = "text-danger";
                        }else if(data[i].TEMP >= 35){
                            tc_temp = "text-warning";
                        }else{
                            tc_temp = "text-success";
                        }

                        if( (data[i].HUM >= 35 && data[i].HUM >= 40) || (data[i].HUM >= 53 && data[i].HUM >= 55) ){
                            tc_hum = "text-warning";
                        }else if((data[i].HUM >= 30 && data[i].HUM >= 35) || (data[i].HUM >= 55 && data[i].HUM >= 57) ) {
                            tc_hum = "text-danger";
                        }else{
                            tc_hum = "text-success";
                        }

                        data[i].FUEL = 36.2;

                        if(data[i].FUEL <= 40){
                            tc_fuel = "text-danger";
                        }else if(data[i].FUEL <= 45){
                            tc_fuel = "text-warning";
                        }

                        if(data[i].VOL <= 180 || data[i].VOL >= 250){
                            tc_vol = "text-danger";
                        }else if(data[i].VOL <= 210 || data[i].VOL >= 230){
                            tc_vol = "text-warning";
                        }else {
                            tc_vol = "text-success";
                        }

                        if(data[i].VOL2 <= 180 || data[i].VOL2 >= 250){
                            tc_vol2 = "text-danger";
                        }else if(data[i].VOL2 <= 210 || data[i].VOL2 >= 230){
                            tc_vol2 = "text-warning";
                        }else {
                            tc_vol2 = "text-success";
                        }
                        
                        if(data[i].VOL3 <= 180 || data[i].VOL3 >= 250){
                            tc_vol3 = "text-danger";
                        }else if(data[i].VOL3 <= 210 || data[i].VOL3 >= 230){
                            tc_vol3 = "text-warning";
                        }else {
                            tc_vol3 = "text-success";
                        }

                        content_envi = 
                            '<div class="row mt-3">'
                                    +'<div class="col-sm-6">Temperature</div>'
                                    +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5 '+tc_temp+'">'+data[i].TEMP+' C</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Humidity</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5 fontnilai '+tc_hum+'">'+data[i].HUM+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Fuel</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5 fontnilai '+tc_fuel+'">'+data[i].FUEL+'</div>'
                            +'</div>'
                            +'<div class="row mt-2">'
                                +'<div class="col-sm-6">Voltage Phase</div>'
                                +'<div class="col-sm-1" style="padding-left: 0;">:</div>'
                                +'<div class="col-sm-5">'
                                    +'<span class="'+tc_vol+'">'+data[i].VOL+' V </span>/<br/>'
                                    +'<span class="'+tc_vol2+'">'+data[i].VOL2+' V </span>/<br/>'
                                    +'<span class="'+tc_vol3+'">'+data[i].VOL3+' V </span>'
                                +'</div>'
                            +'</div>';

                        content_list.push({"SITEID":data[i].SITEID,"SITE_NAME":data[i]["SITE NAME"],"RECT":content_rect,"OVER":content_over,"ENVI":content_envi,"STATUS_ON_OFF":data[i].STATUS_ON_OFF});                            

                        google.maps.event.addListener(marker, 'click', (function(marker, content_rect, content_over, content_envi, i) {
                            return function() {
                                showDetail();
                                $("#head_siteid").html(data[i].SITEID);
                                $("#head_sitename").html(data[i]["SITE NAME"]);  
                                $("#head_status_text").html("Smartsite :");
                                $("#head_status_val").html(data[i].DEVICE_STATUS);
                                $("#rectifier .col-sm-12").html(content_rect);
                                $("#overview .col-sm-12").html(content_over);
                                $("#environment .col-sm-12").html(content_envi);
                                
                                //alert(data[i].STATUS_ON_OFF);

                                setTimeout(function(){
                                    if(data[i].STATUS_ON_OFF == "ON"){
                                        $(".switch-toggle input[type='checkbox']").prop( "checked", true );
                                    }else{
                                        $(".switch-toggle input[type='checkbox']").prop( "checked", false );
                                    }
                                    $(".switch-toggle input[type='checkbox']" ).off();
                                    $(".switch-toggle input[type='checkbox']").change(function(){
                                        var status;
                                        var xbutton = $(this); 
                                        
                                        if($(this).is(':checked')){status = "ON";}
                                        else{status = "OFF";}

                                        $("label[for='gensetset']").hide();

                                        Swal.fire({
                                            title: 'Confirmation',
                                            text: "Are yo sure to "+status+" this site ?",
                                            icon: 'warning',
                                            showCancelButton: true,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Yes, '+status+' it!'
                                        }).then((result) => {
                                            $("label[for='gensetset']").show();
                                            if (result.isConfirmed) {
                                                Swal.fire(
                                                    'Site '+status+'!',
                                                    'Site has been '+status+'.',
                                                    'success'
                                                )
                                                xbutton.prop('checked', xbutton.is(':checked') );

                                                $.ajax({
                                                    type:"POST",
                                                    data:{
                                                        username:"{{ username }}",
                                                        status:status,
                                                        site_id:$("#head_siteid").text()
                                                    },
                                                    url:"/dapot/json/upd_genset_log_bySite/",
                                                    success:function(data){  

                                                    }
                                                });

                                                getMapDot(clickedCategory);
                                            }else{
                                                xbutton.prop('checked', !xbutton.is(':checked') );
                                            }
                                        })

                                        /*var i = window.confirm("Are you sure to "+status+" this site ?");
                                        if(i == true){
                                            //alert("true")
                                            $.ajax({
                                                type:"POST",
                                                data:{
                                                    username:"{{ username }}",
                                                    status:status,
                                                    site_id:$("#head_siteid").text()
                                                },
                                                url:"/dapot/json/upd_genset_log_bySite/",
                                                success:function(data){  

                                                }
                                            });

                                            getMapDot(clickedCategory);
                                            $(this).prop('checked', $(this).is(':checked') );
                                        }
                                        else
                                        {
                                            //alert("false")
                                            $(this).prop('checked', !$(this).is(':checked'));
                                        } */                                                                                                       
                                    });
                                },200);
                            }
                        })(marker, content_rect, content_over, content_envi, i));

                        console.log(data[i].LATITUDE);
                    }
                }
                
                //Set Map Style
                myMap.set('styles', myStyle);    
            },
            complete:function(data){
                var respJson = data.responseJSON;

                $("#inp_searchsite").autocomplete({
                    source: site_list,
                    select:function(e, ui){
                        //$("#legend_tut").hide();
                        //$("#legend_mr").show();
                        //getMrMap($("#inp_site").val(),ui.item.label);
                    }
                });

                $("#searchsite #submit").click(function(){
                    var foundMarker = $.grep(respJson, function(v) {
                        return v.SITEID === $("#inp_searchsite").val() || v["SITE NAME"] === $("#inp_searchsite").val();
                    });

                    var foundContent = $.grep(content_list, function(v) {
                        return v.SITEID === $("#inp_searchsite").val() || v["SITE_NAME"] === $("#inp_searchsite").val();
                    });

                    //console.log(foundArray);

                    var pt = new google.maps.LatLng(parseFloat(foundMarker[0].LATITUDE), parseFloat(foundMarker[0].LONGITUDE));
                    myMap.setCenter(pt);
                    myMap.setZoom(18);

                    var infowindow = new google.maps.InfoWindow({
                        content: foundMarker[0].SITEID,
                        pixelOffset: new google.maps.Size(0, -10)
                    });
                    infowindow.setPosition(pt);
                    infowindow.open(myMap);

                    showDetail();
                    $("#head_siteid").html(foundMarker[0].SITEID);
                    $("#head_sitename").html(foundMarker[0]["SITE NAME"]);  
                    $("#head_status_text").html("Smartsite :");
                    $("#head_status_val").html(foundMarker[0].DEVICE_STATUS);
                    $("#rectifier .col-sm-12").html(foundContent[0].RECT);
                    $("#overview .col-sm-12").html(foundContent[0].OVER);
                    $("#environment .col-sm-12").html(foundContent[0].ENVI);

                    setTimeout(function(){
                        if(foundMarker[0].STATUS_ON_OFF == "ON"){
                            $(".switch-toggle input[type='checkbox']").prop( "checked", true );
                        }else{
                            $(".switch-toggle input[type='checkbox']").prop( "checked", false );
                        }
                        $( ".switch-toggle input[type='checkbox']" ).off();
                        $(".switch-toggle input[type='checkbox']").change(function(){
                            var status;
                            var xbutton = $(this); 
                            
                            if($(this).is(':checked')){status = "ON";}
                            else{status = "OFF";}

                            $("label[for='gensetset']").hide();

                            Swal.fire({
                                title: 'Confirmation',
                                text: "Are yo sure to "+status+" this site ?",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Yes, '+status+' it!'
                            }).then((result) => {
                                $("label[for='gensetset']").show();
                                if (result.isConfirmed) {
                                    Swal.fire(
                                        'Site '+status+'!',
                                        'Site has been '+status+'.',
                                        'success'
                                    )
                                    xbutton.prop('checked', xbutton.is(':checked') );

                                    $.ajax({
                                        type:"POST",
                                        data:{
                                            username:"{{ username }}",
                                            status:status,
                                            site_id:$("#head_siteid").text()
                                        },
                                        url:"/dapot/json/upd_genset_log_bySite/",
                                        success:function(data){  

                                        }
                                    });

                                    getMapDot(clickedCategory);
                                }else{
                                    xbutton.prop('checked', !xbutton.is(':checked') );
                                }
                            })

                            /*var i = window.confirm("Are you sure to "+status+" this site ?");
                            if(i == true){
                                //alert("true")
                                $.ajax({
                                    type:"POST",
                                    data:{
                                        username:"{{ username }}",
                                        status:status,
                                        site_id:$("#head_siteid").text()
                                    },
                                    url:"/dapot/json/upd_genset_log_bySite/",
                                    success:function(data){  

                                    }
                                });

                                getMapDot(clickedCategory);
                                $(this).prop('checked', $(this).is(':checked') );
                            }
                            else
                            {
                                //alert("false")
                                $(this).prop('checked', !$(this).is(':checked'));
                            } */                                                                                                       
                        });
                    },200);
                })
            }
        });
    }

    function showDetail(){
        hasHideDetail = false;
        $("#hasil").show(1000);
        //$("#hasil").css({"cursor": "pointer"});
        $("#map").removeClass('col-md-12');
        $("#map").addClass('col-md-9');
        //$("button.gm-fullscreen-control").css({"right": "0px !important"});
        //$(".gm-bundled-control-on-bottom").css({"right": "40px !important"});
        
        if(!hasClickDetail){
            $( ".circle-1" ).animate({ "left": "-=15vw" }, "slow" );
            hasClickDetail = true;
        }
    }

    function hideDetail(){
        hasClickDetail = false;
        $("#hasil").hide(1000);
        $("#map").removeClass('col-md-9');
        $("#map").addClass('col-md-12');
        
        if(!hasHideDetail){
            hasHideDetail = true;
            $( ".circle-1" ).animate({ "left": "+=15vw" }, "slow" );
        }
    }

    $("#dropdowncategory2 a").click(function(){
        $("#inp_searchsite").val("");
        $("#dropdowncategory:first-child").text($(this).text());
        $("#dropdowncategory:first-child").val($(this).text());
        getMapDot($(this).text());
        clickedCategory = $(this).text();
        hideDetail();
    });

    $('#core_category, #circle1, #circle2, #circle3, #circle4').mouseover(function() {
        $( this ).css({"cursor": "pointer"});
    });
    
    $( ".circle-1" )
    .mouseout(function() {
        $( this ).css({"box-shadow": "none"});
    })
    .mouseover(function() {
        $( this ).css({"box-shadow": "0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)"});
    });

    $("#circle1, #circle2, #circle3, #circle4, #circle5").on('click', function() {
        //$(".modal-body").empty();
        $(".circle-1").hide();
        /*
        switch($(this).attr('id')){
            case 'poi_totalc':
                $(".modal-header h3 b").html("Poi Fail Cell List");
                $("#poi_fail_list").show();
            break;

            case 'avail_achc':
                $(".modal-header h3 b").html("Avail Fail Cell List");
                $("#avail_fail_list").show();
            break;

            case 'quality_achc':
                $(".modal-header h3 b").html("Quality Fail Cell List");
                $("#quality_fail_list").show();
            break;

            case 'packetloss_achc':
                $(".modal-header h3 b").html("Packetloss Fail Cell List");
                $("#pl_fail_list").show();
                
            case 'capacity_achc':
                $(".modal-header h3 b").html("Capacity Fail Cell List");
                $("#capacity_fail_list").show();
            break;
        }*/

        var $j = jQuery.noConflict();
        $j('#my-modal2').show("fast");
        //$("#blurall").css({"filter":"blur(16px)"});
    });

    $("#closemodal").on('click', function() {
        $('#my-modal2').hide("fast");
        //$("#blurall").css({"filter":"blur(0px)"});
        $('.circle-1').show();
    });

    function openCity(evt, cityName) {
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>